---

- include_vars: "defaults/main.yml"

- name: update mysql root password
  mysql_user:
    name=root
    host={{ item }}
    password="{{ ansible_role_mysqlpassword }}"
    login_user=root
    login_password="{{ ansible_role_mysqlpassword }}"
  with_items:
    - "{{ ansible_hostname }}"
    - 127.0.0.1
    - ::1
    - localhost

- name: copy user my.cnf file with root passwd credentials
  template:
    src=my.cnf.j2
    dest=/root/.my.cnf
    owner=root
    group=root mode=0600
  sudo: yes

- name: delete anonymous mysql user
  mysql_user:
    name=""
    state=absent
    login_user=root
    login_password="{{ ansible_role_mysqlpassword }}"

- name: remove mysql test database
  mysql_db:
    name=test
    state=absent
    login_user=root
    login_password="{{ ansible_role_mysqlpassword }}"
